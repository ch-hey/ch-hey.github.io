<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[Eng. Calc.] Symbolic Computation" /><meta property="og:locale" content="en" /><meta name="description" content="이번 공학용계산 포스팅의 주제는 Symbolic Computation, 기호 계산(?)이다. 개인적으로는 보통 그냥 심볼릭한 계산이라고 부른다. Symbolic Calculation이라고 검색해보려 했는데 구글에서 자동완성으로 Computation을 추천한다. 고민없이 Computation을 쓰자." /><meta property="og:description" content="이번 공학용계산 포스팅의 주제는 Symbolic Computation, 기호 계산(?)이다. 개인적으로는 보통 그냥 심볼릭한 계산이라고 부른다. Symbolic Calculation이라고 검색해보려 했는데 구글에서 자동완성으로 Computation을 추천한다. 고민없이 Computation을 쓰자." /><link rel="canonical" href="https://ch-hey.github.io/posts/Engineering-Calculation4/" /><meta property="og:url" content="https://ch-hey.github.io/posts/Engineering-Calculation4/" /><meta property="og:site_name" content="ChBlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-17T19:55:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Eng. Calc.] Symbolic Computation" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-17T19:55:00+08:00","datePublished":"2022-10-17T19:55:00+08:00","description":"이번 공학용계산 포스팅의 주제는 Symbolic Computation, 기호 계산(?)이다. 개인적으로는 보통 그냥 심볼릭한 계산이라고 부른다. Symbolic Calculation이라고 검색해보려 했는데 구글에서 자동완성으로 Computation을 추천한다. 고민없이 Computation을 쓰자.","headline":"[Eng. Calc.] Symbolic Computation","mainEntityOfPage":{"@type":"WebPage","@id":"https://ch-hey.github.io/posts/Engineering-Calculation4/"},"url":"https://ch-hey.github.io/posts/Engineering-Calculation4/"}</script><title>[Eng. Calc.] Symbolic Computation | ChBlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ChBlog"><meta name="application-name" content="ChBlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.github.com/ch-hey/imgcdn/master/rocket.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ChBlog</a></div><div class="site-subtitle font-italic">Markdown to WEB</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ch-hey" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['haner1264','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[Eng. Calc.] Symbolic Computation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[Eng. Calc.] Symbolic Computation</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1666007700" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 17, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ch-hey">HEY</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6088 words"> <em>33 min</em> read</span></div></div></div><div class="post-content"><p>이번 공학용계산 포스팅의 주제는 Symbolic Computation, 기호 계산(?)이다. 개인적으로는 보통 그냥 심볼릭한 계산이라고 부른다. Symbolic Calculation이라고 검색해보려 했는데 구글에서 자동완성으로 Computation을 추천한다. 고민없이 Computation을 쓰자.</p><p>Symbolic한 계산이란 것은 인간이 수행하는 문자간의 연산, 미분, 적분, 라플라스 변환, 일반항에 대한 Summation 등을 생각하면 된다. $x$를 미분하면 1, 적분하면 ${1 \over 2}x^2 +C$ 또는 일반항의 합인 $\sum_{k=1}^n k = {1 \over 2}n(n+1)$ 이런 계산들을 컴퓨터한테 시키는 식이다. 계산 결과 또한 문자에 대한 식으로 나오게 된다. 더 자세한건 <a href="https://en.wikipedia.org/wiki/Computer_algebra">여기</a>를 한번 읽어보자.</p><p>물론 컴퓨터는 이런 연산을 인간처럼 이해하고 하지는 않을 것이다. 사람이 일정한 형태로 짜놓은 명령어대로 움직일 것이다. 다만 이러한 일련의 연산들을 통해 사람이 하는 실수를 줄이거나 귀찮은 작업들을 컴퓨터가 해주는 장점들이 있을 수 있다.</p><p>일하면서는 쓸일이 없었지만 학생 시절에 많이 썼던 기능들이라 따로 소개한다. 알아둬서 나쁠건 없다. 이런게 있구나 하는 정도로 가볍게 넘겨도 좋다.</p><h2 id="1-intro"><span class="mr-2">1. Intro</span><a href="#1-intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>먼저 기억해야 할 점 하나는 컴퓨터를 활용한 Symbolic계산은 Numerical한 접근에 비해서 느리다는 점이다. 그럼에도 Symbolic한 계산을 사용하는 이유는 아주복잡한 식들을 ‘입력’하는데 사람이 일일이 유도하고 타이핑하는 작업을 피하기 위해서다. 물론 다른 이유도 많을 수 있지만 나는 그랬다.</p><p>예를 들어 아주 복잡한 식이 있고(초월함수, 다항함수의 조합에 분모에도 변수가 있지만 미분가능한) 이 식의 다양한 편미분식들을 사용해서 방정식 풀이를 한다고 가정해보자. 미분식들 하나하나 유도하고 입력하다가 지치게 된다. 운이좋아 한방에 잘 입력했으면 모르겠는데 (내 경험상) 항상 실수가 존재하고 이런경우 어디가 문제인지 찾기도 어렵다.</p><p>이럴 때 근원이 되는 복잡한 식 하나만 신경써서 잘 입력해주고 나머지는 Symbolic한 계산을 통해 미분을 취해준다. 이후에 Numerical한 계산을 할 수 있게 변환해주고 필요한 계산을 하면 된다.</p><p>여담으로 적분 연산 결과는 해석해가 존재하지 않는 경우도 있고 적분상수 처리나 정적분의 경우 발산등 미분에 비해 일반적으로 신경쓰기 어려운 부분들이 있어 Symbolic한 계산으로 적분은 추천하지 않는다. 가능하면 제한을 많이두고 Numerical한 적분을 하길 바란다.</p><p>일단은 아래와 같이 간단한 예제를 한번 보자.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">lambdify</span><span class="p">,</span> <span class="n">diff</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">"x"</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">dsdx</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">dsdx_nu</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dsdx</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"s = </span><span class="si">{</span><span class="n">s</span><span class="p">.</span><span class="n">doit</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"dsdx = </span><span class="si">{</span><span class="n">dsdx</span><span class="p">.</span><span class="n">doit</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"dsdx(x=1) = </span><span class="si">{</span><span class="n">dsdx_nu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>s = x**2 + x + 1
dsdx = 2*x + 1
dsdx(x=1) = 3
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">sympy</code>라는 Symbolic계산 전용 모듈을 사용한다. <code class="language-plaintext highlighter-rouge">s</code>라는 변수에 $x$에 대한 2차식을 정의했다. 그리고 <code class="language-plaintext highlighter-rouge">diff</code>명령어로 미분을 취하고 <code class="language-plaintext highlighter-rouge">dsdx</code>라는 변수에 지정해준다 <code class="language-plaintext highlighter-rouge">lambdify</code>명령어로 numerical한 계산을 위해 $x$에 대한 함수로 만들어 <code class="language-plaintext highlighter-rouge">dsdx_nu</code>라는 이름을 주었다. 계산결과는 생각한대로 잘 나온것을 볼 수 있다.</p><p>아래 조금 더 복잡한 예제도 한번 보자. 관련 코드는 <a href="https://stackoverflow.com/questions/26402387/sympy-summation-with-indexed-variable">여기</a>서 따왔다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Sum</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">Indexed</span><span class="p">,</span> <span class="n">lambdify</span><span class="p">,</span> <span class="n">diff</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">"a x i"</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"s = </span><span class="si">{</span><span class="n">s</span><span class="p">.</span><span class="n">doit</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">s2</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"s2 = </span><span class="si">{</span><span class="n">s2</span><span class="p">.</span><span class="n">doit</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">((</span><span class="n">a</span><span class="o">**</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"s3 = </span><span class="si">{</span><span class="n">s3</span><span class="p">.</span><span class="n">doit</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s3</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f3</span><span class="p">))</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">df3</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">f3</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"f(b) = </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"f2(b) = </span><span class="si">{</span><span class="n">f2</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"f3(b) = </span><span class="si">{</span><span class="n">f3</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"df3(b)/da = </span><span class="si">{</span><span class="n">df3</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f3</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">df3</span><span class="p">))</span>

<span class="n">ff3</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">df3</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">ff3</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>s = x[0] + x[1] + x[2] + x[3]
s2 = x[1] + x[2] + x[3]
s3 = a**3*x[3] + a**2*x[2] + a*x[1] + x[0]
&lt;class 'function'&gt;
&lt;class 'function'&gt;
&lt;class 'function'&gt;
f(b) = 10
f2(b) = 9
f3(b) = 4*a**3 + 3*a**2 + 2*a + 1
df3(b)/da = 12*a**2 + 6*a + 2
&lt;class 'numpy.int32'&gt;
&lt;class 'numpy.int32'&gt;
&lt;class 'sympy.core.add.Add'&gt;
&lt;class 'sympy.core.add.Add'&gt;
20
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">indexed</code>라는 기능을 사용했는데 일반항처럼 idnex가 있는 계수들을 처리할 때 편해보인다. 먼저 사용할 symbol들을 정의하고 식을 정의했다. 아래 코드는 다음 식을 의미한다.</p>\[s = \sum_{i=0}^3 x_i\]<div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">(</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span><span class="n">i</span><span class="p">),(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></table></code></div></div><p>이를 <code class="language-plaintext highlighter-rouge">lambdify</code>로 x에 대한 함수를 만들어 <code class="language-plaintext highlighter-rouge">f</code>라고 했다. type을 확인해보면 function이라고 한다. numpy list b를 x에 대응해주면 함수 f는 1 + 2 + 3 + 4의 값을 return 한다. 미안하지만 다른 부분은 알아서 눈치껏 이해해보자. 보다 자세한 설명은 <a href="https://docs.sympy.org/latest/index.html">Sympy Documents</a>를 확인해본다. 너무 무책임해 보이지만,, 어쩔 수 없다. 분량 조절해야된다.</p><p>일단 식을 정의하고 필요한 경우 미분이나 추가적인 심볼릭한 연산을 해준 다음에 수치해석적인 처리가 필요하게 되면 <code class="language-plaintext highlighter-rouge">lambdify</code>를 통해 type을 변환해주어 방정식 풀이나 숫자 대입을 하는 방식이다. 이 흐름만 기억해두자.</p><p>딱 여기까지만 봐도 좋다. 이정도만 봐도 필요할 때 언제든 갖다 쓸 수 있다.</p><p>이 밑의 예제는 훨씬 더 복잡한 상황에서 <code class="language-plaintext highlighter-rouge">sympy</code>를 적용해 보았다. 일단 코드를 짜고나니 아까워서 정리해보긴 했는데 아무리 생각해도 조금 과한것 같다.</p><h2 id="2-symbolic-computation-for-phase-equilibrium"><span class="mr-2">2. Symbolic Computation for Phase Equilibrium</span><a href="#2-symbolic-computation-for-phase-equilibrium" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="21-helmholtz-free-energy-model"><span class="mr-2">2.1. Helmholtz Free Energy Model</span><a href="#21-helmholtz-free-energy-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Symbolic Computation 예제로 이번 포스팅에서 고른 메인 주제는 Helmholtz Free Energy Model을 이용한 상평형 계산이다. 겪어본 가장 복잡한 식을 활용한 symbolic계산과 방정식 풀이의 조합 예제이다.</p><p>Cyclohexane이라는 물질에 대한 열역학 모델 식이며 원 논문은 <a href="https://www.nist.gov/system/files/documents/2018/03/13/10an_equation_of_state_for_the_thermodynamic_properties_of_cyclohexane.pdf">여기</a>에서 받을 수 있다.</p><p>식이 매우 복잡한 만큼 현존하는 모델 중에 정확도가 가장 높고 예측가능한 온도, 압력 범위가 가장 넓다. Aspen+ 같은 공정모사 프로그램에서 REFPROP라는 열역학 모델로 사용할 수 있다. 단, 적용할 수 있는 물질들의 종류가 조금 제한적이다. 모델이나 계산 패키지에 대해 궁금하다면 <a href="https://www.nist.gov/srd/refprop">여기</a>를 읽어보자.</p><p>Helmholtz Free Energy식은 아래와 같이 주어진다.</p>\[{a(\rho, T) \over RT} = \alpha(\delta, \tau) = \alpha^0(\delta, \tau) + \alpha^r(\delta, \tau) \qquad (1)\]<p>$\delta$는 Reduced density로 $\rho / \rho_c$를 의미하며 $\tau$는 <strong>inverse</strong> reduced temperature이며 $T_c/T$로 정의된다. ($\rho$는 밀도, $T$는 온도이고 밑첨자 c는 critical state를 의미한다.) R은 기체상수, $a$는 Helmholtz energy, $\alpha$는 reduced Helmholtz energy, 위첨자 0와 r은 각각 ideal과 residual property를 의미한다.</p><p>식(1)의 ideal term, $\alpha^0$는 아래와 같이 주어져 있다.</p>\[\alpha^0 = a_1 + a_2\tau + \ln\delta + (c_0 - 1)\ln\tau + \sum_{k=1}^4 v_k\ln\left(1-\exp(-u_k \tau / T_c)\right) \qquad (2)\]<p>파라미터의 값은 $c_0$ = 4, $u_1$ = 773, $u_2$ = 941, $u_3$ = 2185, $u_4$ = 4495, $v_1$ = 0.83775, $v_2$ = 16.036, $v_3$ = 24.636, $v_4$ = 7.1715, $a_1$ = 0.9891140602, $a_2$ = 1.6359660572 이라고 한다.</p><p>남아있는 residual term, $\alpha^r$은 아래와 같이 정의된다.</p>\[\begin{align*} \alpha^r(\delta, \tau) &amp;= \sum_{i=1}^5 n_i \delta^{d_i} \tau^{t_i} + \sum_{i=6}^{10} n_i \delta^{d_i} \tau^{t_i} \exp (-\delta^{l_i})\\ &amp; +\sum_{i=11}^{20}n_i \delta^{d_i} \tau^{t_i} \exp(-\eta_i(\delta - \varepsilon_i)^2 - \beta_i(\tau - \gamma_i)^2) \qquad (3) \end{align*}\]<p>이 경우 파라미터는 아래 테이블로 주어진다.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">$i$<th style="text-align: left">$n_i$<th style="text-align: left">$t_i$<th style="text-align: left">$d_i$<th style="text-align: left">$l_i$<th style="text-align: left">$\eta_i$<th style="text-align: left">$\beta_i$<th style="text-align: left">$\gamma_i$<th style="text-align: left">$\varepsilon_i$<tbody><tr><td style="text-align: center">1<td style="text-align: left">0.05483581<td style="text-align: left">1.00<td style="text-align: left">4<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">2<td style="text-align: left">1.607734<td style="text-align: left">0.37<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">3<td style="text-align: left">-2.375928<td style="text-align: left">0.79<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">4<td style="text-align: left">-0.5137709<td style="text-align: left">1.075<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">5<td style="text-align: left">0.1858417<td style="text-align: left">0.37<td style="text-align: left">3<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">6<td style="text-align: left">-0.9007515<td style="text-align: left">2.4<td style="text-align: left">1<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">7<td style="text-align: left">-0.5628776<td style="text-align: left">2.5<td style="text-align: left">3<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">8<td style="text-align: left">0.2903717<td style="text-align: left">0.5<td style="text-align: left">2<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">9<td style="text-align: left">-0.3279141<td style="text-align: left">3<td style="text-align: left">2<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">10<td style="text-align: left">-0.03177644<td style="text-align: left">1.06<td style="text-align: left">7<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<td style="text-align: left">0<tr><td style="text-align: center">11<td style="text-align: left">0.8668676<td style="text-align: left">1.6<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">0.99<td style="text-align: left">0.38<td style="text-align: left">0.65<td style="text-align: left">0.73<tr><td style="text-align: center">12<td style="text-align: left">-0.1962725<td style="text-align: left">0.37<td style="text-align: left">1<td style="text-align: left">0<td style="text-align: left">1.43<td style="text-align: left">4.2<td style="text-align: left">0.63<td style="text-align: left">0.75<tr><td style="text-align: center">13<td style="text-align: left">-0.1425992<td style="text-align: left">1.33<td style="text-align: left">3<td style="text-align: left">0<td style="text-align: left">0.97<td style="text-align: left">1.2<td style="text-align: left">1.14<td style="text-align: left">0.48<tr><td style="text-align: center">14<td style="text-align: left">0.004197016<td style="text-align: left">2.5<td style="text-align: left">3<td style="text-align: left">0<td style="text-align: left">1.93<td style="text-align: left">0.9<td style="text-align: left">0.09<td style="text-align: left">2.32<tr><td style="text-align: center">15<td style="text-align: left">0.1776584<td style="text-align: left">0.9<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0.92<td style="text-align: left">1.2<td style="text-align: left">0.56<td style="text-align: left">0.2<tr><td style="text-align: center">16<td style="text-align: left">-0.04433903<td style="text-align: left">0.5<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">1.27<td style="text-align: left">2.6<td style="text-align: left">0.4<td style="text-align: left">1.33<tr><td style="text-align: center">17<td style="text-align: left">-0.03861246<td style="text-align: left">0.73<td style="text-align: left">3<td style="text-align: left">0<td style="text-align: left">0.87<td style="text-align: left">5.3<td style="text-align: left">1.01<td style="text-align: left">0.68<tr><td style="text-align: center">18<td style="text-align: left">0.07399692<td style="text-align: left">0.2<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">0.82<td style="text-align: left">4.4<td style="text-align: left">0.45<td style="text-align: left">1.11<tr><td style="text-align: center">19<td style="text-align: left">0.02036006<td style="text-align: left">1.5<td style="text-align: left">3<td style="text-align: left">0<td style="text-align: left">1.4<td style="text-align: left">4.2<td style="text-align: left">0.85<td style="text-align: left">1.47<tr><td style="text-align: center">20<td style="text-align: left">0.00272825<td style="text-align: left">1.5<td style="text-align: left">2<td style="text-align: left">0<td style="text-align: left">3<td style="text-align: left">25<td style="text-align: left">0.86<td style="text-align: left">0.99</table></div><p>대략 160개 정도의 파라미터가 전체 모델을 정의하는데 쓰인다.</p><p>Helmholtz Free Energy에 대한 적당한 미분식들을 통해 여러가지 열역학 물성에 대한 식을 뽑아낼 수 있으며 상평형 계산에 필요한 식들도 여기서 나오게 된다. 이 포스팅에서 사용할 물성들은 아래 식으로 구할 수 있다.</p>\[Z = {p \over \rho R T} = 1 + \delta \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau} \qquad (4)\] \[p = R T \rho_c \delta \left[1 + \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau} \right] \qquad (5)\] \[{G \over {RT}}= 1 + \alpha^0 + \alpha^r + \delta \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau} \qquad (6)\]<p>물론 위 식들 이외에도 다양한 열역학 관계식들을 활용해서 Heat Capacity, Joule-Thompson Coefficient, Speed of Sound 등등 여러 물성들을 계산할 수도 있다. 일단 여기서는 위 식(4~6)만 사용해본다. 궁금하면 직접 해보자.</p><p>정리하자면 식(1)로 정리된 Helmholtz Energy를 식(4~6)에서 정의된 편미분 적용을 통해 최종 물성식을 뽑아내고 상평형 계산을 수행해 볼 것이다. 당연히 미분에는 <code class="language-plaintext highlighter-rouge">sympy</code>를 쓰고 방정식 풀이를 위해 <code class="language-plaintext highlighter-rouge">lambdify</code>와 공학용계산 모듈인 <code class="language-plaintext highlighter-rouge">scipy</code>를 쓸 것이다.</p><p>상평형 계산은 임의의 온도 $\tau$에서 아래 두개의 방정식(equal pressure, equal gibbs energy)을 만족시키는 두 개의 density $\delta’$, $\delta’‘$를 구하게 한다.</p>\[p(\tau, \delta') = p(\tau, \delta'') \qquad (7)\] \[G(\tau, \delta') = G(\tau, \delta'') \qquad (8)\]<h3 id="22-python-code"><span class="mr-2">2.2. Python Code</span><a href="#22-python-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>파라미터가 160개 가량 되는 모델식을 코드로 입력해야 하는 것 뿐만 아니라 이 식을 손으로 미분까지해서 또 새로 코드를 작성한다는 것은 생산성도 떨어질 뿐더러 실수할 가능성도 너무 많다. (물론, 이런일을 해야 할 상황이 인생에서 많지는 않다.)</p><p>어찌됬든 <code class="language-plaintext highlighter-rouge">sympy</code>를 이용하는 방식이 이러한 상황에서 그나마 가장 효율적이고 실수도 덜한 방법의 조합이라고 생각한다.</p><p>아래 코드도 몇 번이나 실수한 끝에 겨우 성공한 것이기도 하다. 이 모듈이 없었다면, 시도조차 안했을 것 같다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
</pre></table></code></div></div><p>사용할 모듈은 <code class="language-plaintext highlighter-rouge">sympy</code>가 메인이다. 다른모듈은 다른 포스팅에서 이미 다루었다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">symbols</span><span class="p">(</span><span class="s">"delta tau i v u n t d l eta beta gamma epsilon"</span><span class="p">)</span>

<span class="n">vi</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'v'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ui</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'u'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ni</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'n'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'t'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">di</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'d'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">li</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'l'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">etai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'eta'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">betai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">gammai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'gamma'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">epsiloni</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'epsilon'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="n">Tc</span> <span class="o">=</span> <span class="mf">553.6</span>      <span class="c1"># kelvin
</span><span class="n">rhoc</span> <span class="o">=</span> <span class="mf">3.224</span>    <span class="c1"># mol/dm-3
</span><span class="n">R</span> <span class="o">=</span> <span class="mf">0.008314</span>    <span class="c1"># MPa dm-3 / mol K
</span><span class="n">Mw</span> <span class="o">=</span> <span class="mf">84.15948</span>   <span class="c1"># g mol-1
</span>
<span class="c1"># &lt;------------------------------------------- Define Ideal Helmholtz Energy ------------------------------------------------&gt; #
</span><span class="n">a1</span> <span class="o">=</span> <span class="mf">0.9891140602</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">1.6359660572</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">u_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">773</span><span class="p">,</span> <span class="mi">941</span><span class="p">,</span> <span class="mi">2185</span><span class="p">,</span> <span class="mi">4495</span><span class="p">])</span>
<span class="n">v_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.83775</span><span class="p">,</span> <span class="mf">16.036</span><span class="p">,</span> <span class="mf">24.636</span><span class="p">,</span> <span class="mf">7.1715</span><span class="p">])</span>

<span class="n">ideal</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">tau</span> <span class="o">+</span> <span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">+</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">vi</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ui</span><span class="o">*</span><span class="n">tau</span><span class="o">/</span><span class="n">Tc</span><span class="p">)),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># &lt;------------------------------------------- Define Residual Helmholtz Energy ------------------------------------------------&gt; #
</span>
<span class="n">n_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05483581</span><span class="p">,</span> <span class="mf">1.607734</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.375928</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5137709</span><span class="p">,</span> <span class="mf">0.1858417</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9007515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5628776</span><span class="p">,</span> <span class="mf">0.2903717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3279141</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03177644</span><span class="p">,</span> <span class="mf">0.8668676</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1962725</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1425992</span><span class="p">,</span> <span class="mf">0.004197016</span><span class="p">,</span> <span class="mf">0.1776584</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04433903</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03861246</span><span class="p">,</span> <span class="mf">0.07399692</span><span class="p">,</span> <span class="mf">0.02036006</span><span class="p">,</span> <span class="mf">0.00272825</span><span class="p">])</span>
<span class="n">t_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.79</span><span class="p">,</span> <span class="mf">1.075</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">1.33</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">d_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">l_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">eta_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">1.93</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">,</span> <span class="mf">1.27</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">beta_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="n">gamma_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">1.14</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.86</span><span class="p">])</span>
<span class="n">epsilon_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">2.32</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.33</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.47</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">])</span>

<span class="n">residual1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">),(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">residual2</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">delta</span><span class="o">**</span><span class="n">li</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">residual3</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">etai</span><span class="o">*</span><span class="p">((</span><span class="n">delta</span><span class="o">-</span><span class="n">epsiloni</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">betai</span><span class="o">*</span><span class="p">((</span><span class="n">tau</span> <span class="o">-</span> <span class="n">gammai</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">residual</span> <span class="o">=</span> <span class="n">residual1</span> <span class="o">+</span> <span class="n">residual2</span> <span class="o">+</span> <span class="n">residual3</span>

<span class="c1"># &lt;---------------------------- Differentiate Helmholtz Energy to obtain specific property ----------------------------------&gt; #
</span>
<span class="n">Z</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Z</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">Tc</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">G</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ideal</span> <span class="o">+</span> <span class="n">residual</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
</pre></table></code></div></div><p>사용해야 할 symbol들의 종류도 워낙 많아서 좀 헷갈릴 수 있다. Intro에서 다루었던 예제를 생각해 보면 그래도 금방 이해될 것이다. 최종적으로 식(1)에 해당하는 Helmholtz Free Energy를 <code class="language-plaintext highlighter-rouge">residual</code>이라는 변수로 정의했고 식(4~6)에 해당하는 미분을 <code class="language-plaintext highlighter-rouge">sympy.diff</code>명령어 한줄로 끝낸다.</p><p>식(1)만 신경써서 작성하면 된다. 여지없이 여기에서 계속 실수를 했었다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">P_num</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">P_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">P</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">P_inter</span><span class="p">(</span><span class="n">v_value</span><span class="p">,</span> <span class="n">u_value</span><span class="p">,</span> <span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">G_num</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">G_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">G</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G_inter</span><span class="p">(</span><span class="n">v_value</span><span class="p">,</span> <span class="n">u_value</span><span class="p">,</span> <span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">equil_eqn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">delta_a</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">delta_b</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">equal_pres</span> <span class="o">=</span> <span class="n">P_num</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_set</span><span class="p">)</span> <span class="o">-</span> <span class="n">P_num</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_set</span><span class="p">)</span>
    <span class="n">equal_G</span> <span class="o">=</span> <span class="n">G_num</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_set</span><span class="p">)</span> <span class="o">-</span> <span class="n">G_num</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_set</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">equal_pres</span><span class="p">,</span> <span class="n">equal_G</span><span class="p">]</span>
</pre></table></code></div></div><p>상평형 계산에 사용할 함수들을 정의한다. 수치해석 계산을 위해 <code class="language-plaintext highlighter-rouge">sympy</code>식들을 <code class="language-plaintext highlighter-rouge">lambdify</code>를 통해 일종의 형태(type)변환을 해준다. <code class="language-plaintext highlighter-rouge">equil_eqn</code>함수가 <code class="language-plaintext highlighter-rouge">fsolve</code>를 적용해 풀어줘야 할 방정식에 해당한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">den_a</span> <span class="o">=</span> <span class="mf">9.37</span>
<span class="n">den_b</span> <span class="o">=</span> <span class="mf">0.0027</span>

<span class="n">delta_a</span> <span class="o">=</span> <span class="n">den_a</span><span class="o">/</span><span class="n">rhoc</span>
<span class="n">delta_b</span> <span class="o">=</span> <span class="n">den_b</span><span class="o">/</span><span class="n">rhoc</span>

<span class="n">temp_set</span> <span class="o">=</span> <span class="mi">283</span>
<span class="n">tau_set</span> <span class="o">=</span> <span class="n">Tc</span><span class="o">/</span><span class="n">temp_set</span>

<span class="n">root_eq</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equil_eqn</span><span class="p">,</span> <span class="p">[</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">delta_b</span><span class="p">])</span>

<span class="n">root</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">root</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">root_eq</span><span class="p">)</span>
<span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_set</span><span class="p">]</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">temp_start</span> <span class="o">=</span> <span class="n">temp_set</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="n">Tc</span><span class="p">)</span><span class="o">-</span><span class="n">temp_start</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">temp_set</span> <span class="o">=</span> <span class="n">temp_set</span> <span class="o">+</span> <span class="n">step</span>
    <span class="k">if</span> <span class="n">temp_set</span> <span class="o">&gt;=</span> <span class="n">Tc</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">temp_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_set</span><span class="p">)</span>
    <span class="n">tau_set</span> <span class="o">=</span> <span class="n">Tc</span><span class="o">/</span><span class="n">temp_set</span>
    <span class="n">root_eq</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equil_eqn</span><span class="p">,</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">root</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">root_eq</span><span class="p">)</span>
</pre></table></code></div></div><p>이전 포스팅에서와 비슷한 느낌으로 이전계산에서 얻은 답을 다음번 계산의 초기값으로 넣어주는 방식이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="n">den_a_list</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">den_b_list</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">pres_list</span> <span class="o">=</span> <span class="n">P_num</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Tc</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_list</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">temp_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">283</span><span class="p">,</span><span class="mi">313</span><span class="p">,</span><span class="mi">343</span><span class="p">,</span><span class="mi">373</span><span class="p">,</span><span class="mi">403</span><span class="p">,</span><span class="mi">433</span><span class="p">,</span><span class="mi">463</span><span class="p">,</span><span class="mi">493</span><span class="p">,</span><span class="mi">523</span><span class="p">,</span><span class="mi">553</span><span class="p">])</span>
<span class="n">den_a_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.3644</span><span class="p">,</span><span class="mf">9.0275</span><span class="p">,</span><span class="mf">8.6788</span><span class="p">,</span><span class="mf">8.314</span><span class="p">,</span><span class="mf">7.927</span><span class="p">,</span><span class="mf">7.5071</span><span class="p">,</span><span class="mf">7.0341</span><span class="p">,</span><span class="mf">6.4677</span><span class="p">,</span><span class="mf">5.7026</span><span class="p">,</span><span class="mf">3.721</span><span class="p">])</span>
<span class="n">den_b_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.002687</span><span class="p">,</span><span class="mf">0.0095389</span><span class="p">,</span><span class="mf">0.026088</span><span class="p">,</span><span class="mf">0.059385</span><span class="p">,</span><span class="mf">0.11875</span><span class="p">,</span><span class="mf">0.21701</span><span class="p">,</span><span class="mf">0.37422</span><span class="p">,</span><span class="mf">0.62851</span><span class="p">,</span><span class="mf">1.08</span><span class="p">,</span><span class="mf">2.7321</span><span class="p">])</span>
<span class="n">pres_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0062923</span><span class="p">,</span><span class="mf">0.024494</span><span class="p">,</span><span class="mf">0.072215</span><span class="p">,</span><span class="mf">0.17403</span><span class="p">,</span><span class="mf">0.3613</span><span class="p">,</span><span class="mf">0.67039</span><span class="p">,</span><span class="mf">1.1417</span><span class="p">,</span><span class="mf">1.8204</span><span class="p">,</span><span class="mf">2.7605</span><span class="p">,</span><span class="mf">4.0495</span><span class="p">])</span>

<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Saturated Density'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">den_a_list</span><span class="p">,</span> <span class="n">temp_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">den_b_list</span><span class="p">,</span> <span class="n">temp_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">den_a_data</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">den_b_data</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Molar Density(mol/l)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Temperature(K)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Vapor Pressure'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temp_list</span><span class="p">,</span> <span class="n">pres_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">pres_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Tmmperature(K)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Pressure(MPa'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p>Data는 <a href="https://webbook.nist.gov/chemistry/fluid/">NIST Webbook</a>에서 따왔고 temp_data, den_a_data, den_b_data, pres_data에 해당한다. 결과는 매우 정확하다. (애초에 NIST Webbook은 이 모델의 결과를 알려준다.)</p><p><img data-src="https://raw.github.com/ch-hey/imgcdn/master/img/2022-10-18/output_6_0.png" alt="png" data-proofer-ignore></p><p><img data-src="https://raw.github.com/ch-hey/imgcdn/master/img/2022-10-18/output_6_1.png" alt="png" data-proofer-ignore></p><h2 id="3-advanced-algorithm"><span class="mr-2">3. Advanced Algorithm</span><a href="#3-advanced-algorithm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>위에서 다룬 계산은 상당히 복잡한 비선형 방정식 2개로 이루어진 시스템에 대한 풀이에 해당한다. 한방에 모든 방정식을 풀려고 할 때 수치해석적인 풀이를 위해서는 답에 거의 근접한 초기값을 넣어주어야 한다. 그래서 보통 이러한 계산은 초기값에 대한 민감성을 덜어주기 위해 다양한 방식의 successive substitution 알고리즘이 적용된다.</p><p>Ryo Akasaka라는 분이 쓰신 이 <a href="https://www.jstage.jst.go.jp/article/jtst/3/3/3_3_442/_article">논문</a>에 나온 알고리즘을 적용해 본다. 나름 이해하기 쉽게 작성이 되어 있어서 관심있으면 읽어보는 것도 좋을 것 같다.</p><p>실은 위에 애써 짜놓은 코드들 그냥 버리기 아까워서 이거조금 더 써먹어 본다.</p><h3 id="31-newton-raphson-algorithm-for-simultaneous-equations"><span class="mr-2">3.1. Newton-Raphson algorithm for simultaneous equations</span><a href="#31-newton-raphson-algorithm-for-simultaneous-equations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>풀어야 하는 방정식이 여러개 있는 경우에 적용되는 Newton-Raphson 형태의 수치해석 알고리즘을 적용한다. 잠시 논문내용을 정리해본다.</p><p>Ideal Helmholtz term에 해당하는 식(2)는 아래처럼 표현할 수 있다.</p>\[\alpha^0 = \ln\delta + f(\tau) \qquad (9)\]<p>여기서 $f$ 는 온도만의 함수에 해당한다.</p><p>따라서 상평형 조건에 해당하는 식(7~8)을 정리하면 아래와 같이 주어진다.</p>\[\delta' \left[1 + \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau, \delta = \delta'} \right] = \delta'' \left[1 + \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau, \delta = \delta''} \right] \qquad (10)\] \[\ln\delta' + \alpha^r(\tau, \delta') + \delta' \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau, \delta = \delta'} = \ln\delta'' + \alpha^r(\tau, \delta'') + \delta'' \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau, \delta = \delta''} \qquad (11)\]<p>$J(\tau, \delta)$와 $K(\tau, \delta)$를 아래와 같이 정의하자.</p>\[J(\tau, \delta) = \delta \left[{1 + \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau}}\right] \qquad (12)\] \[K(\tau, \delta) = \ln\delta + \alpha^r(\tau, \delta) + \delta \left( {\partial \alpha^r \over \partial \delta}\right)_{\tau} \qquad (13)\]<p>이러면 식 (10~11)은 최종적으로 아래와 같이 정리된다.</p>\[J(\tau, \delta') = J(\tau, \delta'') \qquad (14)\] \[K(\tau, \delta') = K(\tau, \delta'') \qquad (15)\]<p>임의의 $\tau$ 에서 두 개의 미지수 $\delta’$와 $\delta’‘$는 위 식 두개를 풀면서 얻어지게 된다.</p><p>이 부분에서 Newton-Raphson algorithm for simultaneous equations 를 적용하면 아래와 같이 successive substitution 형태의 식을 얻게된다.</p>\[\delta'^{(k+1)} = \delta'^{(k)} + {\gamma \over \Delta}\left\{ (K(\tau, \delta'') - K(\tau, \delta'))\left({\partial J \over \partial \delta}\right)_{\tau, \delta = \delta''} - (J(\tau, \delta'') - J(\tau, \delta'))\left({\partial K \over \partial \delta}\right)_{\tau, \delta = \delta''} \right\} \qquad (16)\] \[\delta''^{(k+1)} = \delta''^{(k)} + {\gamma \over \Delta}\left\{ (K(\tau, \delta'') - K(\tau, \delta'))\left({\partial J \over \partial \delta}\right)_{\tau, \delta = \delta'} - (J(\tau, \delta'') - J(\tau, \delta'))\left({\partial K \over \partial \delta}\right)_{\tau, \delta = \delta'} \right\} \qquad (17)\]<p>여기서 $\Delta$는 아래와 같다.</p>\[\Delta = \left({\partial J \over \partial \delta}\right)_{\tau, \delta = \delta''} \left({\partial K \over \partial \delta}\right)_{\tau, \delta = \delta'} - \left({\partial J \over \partial \delta}\right)_{\tau, \delta = \delta'} \left({\partial K \over \partial \delta}\right)_{\tau, \delta = \delta''} \qquad (18)\]<p>Step size를 의미하는 $\gamma$는 특수한 경우가 아닌이상 1로 둔다.</p><p>최종적으로 아래의 Convergence Criteria를 사용했다.</p>\[\left( K(\tau, \delta'') - K(\tau, \delta') \right)^2 + \left( J(\tau, \delta'') - J(\tau, \delta') \right)^2 &lt; 10^{-20} \qquad (19)\]<p>복잡해 보이지만 그냥 미분좀 더 하면 된다.</p><h3 id="32-python-code"><span class="mr-2">3.2. Python Code</span><a href="#32-python-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>2장에서 사용한 Code와 거의 비슷한 흐름이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">fsolve</code>함수는 사용되지 않는다. 실수로 안지웠다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">symbols</span><span class="p">(</span><span class="s">"delta tau i v u n t d l eta beta gamma epsilon"</span><span class="p">)</span>

<span class="n">vi</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'v'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ui</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'u'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ni</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'n'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'t'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">di</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'d'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">li</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'l'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">etai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'eta'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">betai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'beta'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">gammai</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'gamma'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">epsiloni</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Indexed</span><span class="p">(</span><span class="s">'epsilon'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="n">Tc</span> <span class="o">=</span> <span class="mf">553.6</span>      <span class="c1"># kelvin
</span><span class="n">rhoc</span> <span class="o">=</span> <span class="mf">3.224</span>    <span class="c1"># mol/dm-3
</span><span class="n">R</span> <span class="o">=</span> <span class="mf">0.0083144621</span>    <span class="c1"># MPa dm-3 / mol K
</span><span class="n">Mw</span> <span class="o">=</span> <span class="mf">84.15948</span>   <span class="c1"># g mol-1
</span>
<span class="c1"># &lt;------------------------------------------- Define Ideal Helmholtz Energy ------------------------------------------------&gt; #
</span><span class="n">a1</span> <span class="o">=</span> <span class="mf">0.9891140602</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">1.6359660572</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">u_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">773</span><span class="p">,</span> <span class="mi">941</span><span class="p">,</span> <span class="mi">2185</span><span class="p">,</span> <span class="mi">4495</span><span class="p">])</span>
<span class="n">v_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.83775</span><span class="p">,</span> <span class="mf">16.036</span><span class="p">,</span> <span class="mf">24.636</span><span class="p">,</span> <span class="mf">7.1715</span><span class="p">])</span>

<span class="n">ideal</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">tau</span> <span class="o">+</span> <span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">+</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">vi</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ui</span><span class="o">*</span><span class="n">tau</span><span class="o">/</span><span class="n">Tc</span><span class="p">)),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># &lt;------------------------------------------- Define Residual Helmholtz Energy ------------------------------------------------&gt; #
</span>
<span class="n">n_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05483581</span><span class="p">,</span> <span class="mf">1.607734</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.375928</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5137709</span><span class="p">,</span> <span class="mf">0.1858417</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9007515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5628776</span><span class="p">,</span> <span class="mf">0.2903717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3279141</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03177644</span><span class="p">,</span> <span class="mf">0.8668676</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1962725</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1425992</span><span class="p">,</span> <span class="mf">0.004197016</span><span class="p">,</span> <span class="mf">0.1776584</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04433903</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03861246</span><span class="p">,</span> <span class="mf">0.07399692</span><span class="p">,</span> <span class="mf">0.02036006</span><span class="p">,</span> <span class="mf">0.00272825</span><span class="p">])</span>
<span class="n">t_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.79</span><span class="p">,</span> <span class="mf">1.075</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">1.33</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">d_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">l_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">eta_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">1.93</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">,</span> <span class="mf">1.27</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">beta_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="n">gamma_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">1.14</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.86</span><span class="p">])</span>
<span class="n">epsilon_value</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">2.32</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.33</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.47</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">])</span>

<span class="n">residual1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">),(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">residual2</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">delta</span><span class="o">**</span><span class="n">li</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">residual3</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">ni</span><span class="o">*</span><span class="p">(</span><span class="n">delta</span><span class="o">**</span><span class="n">di</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="n">ti</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">etai</span><span class="o">*</span><span class="p">((</span><span class="n">delta</span><span class="o">-</span><span class="n">epsiloni</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">betai</span><span class="o">*</span><span class="p">((</span><span class="n">tau</span> <span class="o">-</span> <span class="n">gammai</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">residual</span> <span class="o">=</span> <span class="n">residual1</span> <span class="o">+</span> <span class="n">residual2</span> <span class="o">+</span> <span class="n">residual3</span>

<span class="c1"># &lt;---------------------------- Differentiate Helmholtz Energy to obtain specific property ----------------------------------&gt; #
</span>
<span class="n">Z</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">Z</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">Tc</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">G</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ideal</span> <span class="o">+</span> <span class="n">residual</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

<span class="n">J_s</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">))</span>
<span class="n">K_s</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="n">residual</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

<span class="n">delJ_s</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">J_s</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="n">delK_s</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">K_s</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
</pre></table></code></div></div><p>2장에서 추가로 $J$, $K$와 이들의 편미분에 대한 식만 더 추가했다. 미분처리는 정말 편하다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">J_n</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">J_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">J_s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">J_inter</span><span class="p">(</span><span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">K_n</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">K_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">K_s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">K_inter</span><span class="p">(</span><span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delJ_n</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">delJ_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">delJ_s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delJ_inter</span><span class="p">(</span><span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delK_n</span><span class="p">(</span><span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">):</span>
    <span class="n">delK_inter</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="n">delK_s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delK_inter</span><span class="p">(</span><span class="n">n_value</span><span class="p">,</span> <span class="n">t_value</span><span class="p">,</span> <span class="n">d_value</span><span class="p">,</span> <span class="n">l_value</span><span class="p">,</span> <span class="n">eta_value</span><span class="p">,</span> <span class="n">beta_value</span><span class="p">,</span> <span class="n">gamma_value</span><span class="p">,</span> <span class="n">epsilon_value</span><span class="p">,</span> <span class="n">delta_n</span><span class="p">,</span> <span class="n">tau_n</span><span class="p">)</span>
</pre></table></code></div></div><p>마찬가지로 <code class="language-plaintext highlighter-rouge">lambdify</code>이용한 type 변환을 해준다. 이제 숫자를 더 빠르게 뽑아낼 수 있다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">advanced_eqili</span><span class="p">(</span><span class="n">tau_test</span><span class="p">,</span> <span class="n">delta_a</span><span class="p">,</span> <span class="n">delta_b</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">ddelta</span> <span class="o">=</span> <span class="n">delJ_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span><span class="o">*</span><span class="n">delK_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">delJ_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span><span class="o">*</span><span class="n">delK_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span>
        <span class="n">delta_a</span> <span class="o">=</span> <span class="n">delta_a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ddelta</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">K_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">K_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">*</span><span class="n">delJ_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">J_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">J_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">*</span><span class="n">delK_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span>
        <span class="n">delta_b</span> <span class="o">=</span> <span class="n">delta_b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ddelta</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">K_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">K_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">*</span><span class="n">delJ_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">J_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">J_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">*</span><span class="n">delK_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">((</span><span class="n">K_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">K_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">J_n</span><span class="p">(</span><span class="n">delta_b</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">J_n</span><span class="p">(</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">tau_test</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">criteria</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">20</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">delta_a</span><span class="p">,</span> <span class="n">delta_b</span><span class="p">]</span>
</pre></table></code></div></div><p>Newton-Raphson방식으로 얻어지는 successive substitution형태를 <code class="language-plaintext highlighter-rouge">advanced_equil</code>로 정의한다. 식(16~18)에 해당한다.</p><p>이후로는 완전히 동일하다. <code class="language-plaintext highlighter-rouge">fsolve</code>가 <code class="language-plaintext highlighter-rouge">advanced_equil</code>함수로 치환된 형태다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">den_a</span> <span class="o">=</span> <span class="mf">9.3991</span>
<span class="n">den_b</span> <span class="o">=</span> <span class="mf">2.31</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>

<span class="n">delta_a</span> <span class="o">=</span> <span class="n">den_a</span><span class="o">/</span><span class="n">rhoc</span>
<span class="n">delta_b</span> <span class="o">=</span> <span class="n">den_b</span><span class="o">/</span><span class="n">rhoc</span>

<span class="n">temp_set</span> <span class="o">=</span> <span class="mi">283</span>
<span class="n">tau_set</span> <span class="o">=</span> <span class="n">Tc</span><span class="o">/</span><span class="n">temp_set</span>

<span class="n">root_eq</span> <span class="o">=</span> <span class="n">advanced_eqili</span><span class="p">(</span><span class="n">tau_set</span><span class="p">,</span> <span class="n">delta_a</span><span class="p">,</span> <span class="n">delta_b</span><span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">root</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">root_eq</span><span class="p">)</span>
<span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_set</span><span class="p">]</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">temp_start</span> <span class="o">=</span> <span class="n">temp_set</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="n">Tc</span><span class="p">)</span><span class="o">-</span><span class="n">temp_start</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">temp_set</span> <span class="o">=</span> <span class="n">temp_set</span> <span class="o">+</span> <span class="n">step</span>
    <span class="k">if</span> <span class="n">temp_set</span> <span class="o">&gt;=</span> <span class="n">Tc</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">temp_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_set</span><span class="p">)</span>
    <span class="n">tau_set</span> <span class="o">=</span> <span class="n">Tc</span><span class="o">/</span><span class="n">temp_set</span>
    <span class="n">root_eq</span> <span class="o">=</span> <span class="n">advanced_eqili</span><span class="p">(</span><span class="n">tau_set</span><span class="p">,</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">root</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">root_eq</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="n">den_a_list</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">den_b_list</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rhoc</span>
<span class="n">pres_list</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span><span class="o">*</span><span class="n">rhoc</span><span class="o">*</span><span class="n">J_n</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">root</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tc</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_list</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">temp_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">283</span><span class="p">,</span><span class="mi">313</span><span class="p">,</span><span class="mi">343</span><span class="p">,</span><span class="mi">373</span><span class="p">,</span><span class="mi">403</span><span class="p">,</span><span class="mi">433</span><span class="p">,</span><span class="mi">463</span><span class="p">,</span><span class="mi">493</span><span class="p">,</span><span class="mi">523</span><span class="p">,</span><span class="mi">553</span><span class="p">])</span>
<span class="n">den_a_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.3644</span><span class="p">,</span><span class="mf">9.0275</span><span class="p">,</span><span class="mf">8.6788</span><span class="p">,</span><span class="mf">8.314</span><span class="p">,</span><span class="mf">7.927</span><span class="p">,</span><span class="mf">7.5071</span><span class="p">,</span><span class="mf">7.0341</span><span class="p">,</span><span class="mf">6.4677</span><span class="p">,</span><span class="mf">5.7026</span><span class="p">,</span><span class="mf">3.721</span><span class="p">])</span>
<span class="n">den_b_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.002687</span><span class="p">,</span><span class="mf">0.0095389</span><span class="p">,</span><span class="mf">0.026088</span><span class="p">,</span><span class="mf">0.059385</span><span class="p">,</span><span class="mf">0.11875</span><span class="p">,</span><span class="mf">0.21701</span><span class="p">,</span><span class="mf">0.37422</span><span class="p">,</span><span class="mf">0.62851</span><span class="p">,</span><span class="mf">1.08</span><span class="p">,</span><span class="mf">2.7321</span><span class="p">])</span>
<span class="n">pres_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0062923</span><span class="p">,</span><span class="mf">0.024494</span><span class="p">,</span><span class="mf">0.072215</span><span class="p">,</span><span class="mf">0.17403</span><span class="p">,</span><span class="mf">0.3613</span><span class="p">,</span><span class="mf">0.67039</span><span class="p">,</span><span class="mf">1.1417</span><span class="p">,</span><span class="mf">1.8204</span><span class="p">,</span><span class="mf">2.7605</span><span class="p">,</span><span class="mf">4.0495</span><span class="p">])</span>

<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Saturated Density'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">den_a_list</span><span class="p">,</span> <span class="n">temp_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">den_b_list</span><span class="p">,</span> <span class="n">temp_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">den_a_data</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">den_b_data</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Molar Density(mol/l)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Temperature(K)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Vapor Pressure'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temp_list</span><span class="p">,</span> <span class="n">pres_list</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">temp_data</span><span class="p">,</span> <span class="n">pres_data</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Tmmperature(K)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Pressure(MPa'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p>결과 그림은 굳이 필요 없을 것 같다. 2장의 결과와 동일하다. 코드를 직접 가지고 조금 놀다보면 초기값에 좀 덜 민감한 느낌을 받기는 한다.</p><p>다만 계산시간이 오래걸린다. <code class="language-plaintext highlighter-rouge">advanced_eqili</code>함수를 정의할 때 for문으로 작성한 부분이 아마도 문제일 것으로 보인다. Vectorized 형태로 쓰거나 좀 더 빠르게 돌아가는 형태의 코드를 작성해보면 좋겠지만, 아직은 잘 모르겠다. 어찌됬든 돌아는 가고 답은 나온다. 지금은 기능 구현에 집중하자.</p><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">sympy</code>를 활용한 공학용 계산을 다루었다. 포스팅 작성하면서 구글링 해볼때 심볼릭한 계산을 다루는 python 예제에서는 거의 예외없이 <code class="language-plaintext highlighter-rouge">sympy</code>가 사용되었던 것 같다.</p><p>일단 식을 정의하고 필요한 경우 미분이나 추가적인 심볼릭한 연산을 해준 다음에 수치해석적인 처리가 필요하게 되면 <code class="language-plaintext highlighter-rouge">lambdify</code>를 통해 type을 변환해주어 방정식 풀이나 숫자 대입을 하는 방식이었다. 이 흐름만 기억해두자. 다른 복잡한 식들은 그냥 다 잊어도 좋을 것 같다.</p><p>예제를 잘못 골랐는지 이번 글은 분량조절도 실패하고 개인적으로 너무 힘들었다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/engineering-calculation/'>Engineering Calculation</a>, <a href='/categories/symbolic-computation/'>Symbolic Computation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/engineering-calculation/" class="post-tag no-text-decoration" >Engineering Calculation</a> <a href="/tags/python/" class="post-tag no-text-decoration" >Python</a> <a href="/tags/symbolic-computation/" class="post-tag no-text-decoration" >Symbolic Computation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%5BEng.+Calc.%5D+Symbolic+Computation+-+ChBlog&url=https%3A%2F%2Fch-hey.github.io%2Fposts%2FEngineering-Calculation4%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%5BEng.+Calc.%5D+Symbolic+Computation+-+ChBlog&u=https%3A%2F%2Fch-hey.github.io%2Fposts%2FEngineering-Calculation4%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fch-hey.github.io%2Fposts%2FEngineering-Calculation4%2F&text=%5BEng.+Calc.%5D+Symbolic+Computation+-+ChBlog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/venv-Python-32bit/">[Python] Virtual Env(venv)로 가상환경 만들기</a><li><a href="/posts/AI-Tensorflow/">[머신러닝] Tensorflow</a><li><a href="/posts/Neural-Network/">[머신러닝] 인공신경망 Artificial Neural Network</a><li><a href="/posts/Engineering-Calculation/">[Eng. Calc.] Differential Equations - Kinetics</a><li><a href="/posts/Orientation/">Orientation</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/engineering-calculation/">Engineering Calculation</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/andrew-ng/">Andrew NG</a> <a class="post-tag" href="/tags/aspen-plus/">Aspen Plus</a> <a class="post-tag" href="/tags/com-object/">COM Object</a> <a class="post-tag" href="/tags/coursera/">Coursera</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Engineering-Calculation/"><div class="card-body"> <em class="small" data-ts="1661169300" data-df="ll" > Aug 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Eng. Calc.] Differential Equations - Kinetics</h3><div class="text-muted small"><p> 공학용 계산 첫 번째 포스팅이다. 첫번째 주제는 반응속도식 문제 풀이다. 수학으로는 미분방정식 풀이와 fitting 예제에 해당한다. 계산에는 Python을 쓴다. 1. Intro 간단한 문제에서부터 시작하려고 한다. 이 문서의 예제와 데이터를 따라가본다. 아래 반응을 보자. [A \rightarrow B] 반응속도식을 정하는건 이런저런 고려들...</p></div></div></a></div><div class="card"> <a href="/posts/Engineering-Calculation2/"><div class="card-body"> <em class="small" data-ts="1662378900" data-df="ll" > Sep 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Eng. Calc.] Regression and Curve-Fit</h3><div class="text-muted small"><p> 이번 공학용 계산 주제는 Regression 이다. 편의상 Fitting 이라고도 한다. Regression, Fitting 원래는 명확한 구분이 있을거 같으면서도 굉장히 혼용되서 사용되는 단어 같다. 실은 딱히 명확한 구분은 없는 것 같다. 관련해선 이 문서를 한 번 읽어보자. 여기서는 변수, independent variable $x$에 대해서 ...</p></div></div></a></div><div class="card"> <a href="/posts/Engineering-Calculation3/"><div class="card-body"> <em class="small" data-ts="1663502100" data-df="ll" > Sep 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Eng. Calc.] Nonlinear Equations Solving</h3><div class="text-muted small"><p> 이번 공학용계산 포스팅의 주제는 Equation Solving, 방정식 풀이다. 선형방정식에 대한 풀이는 손으로도 쉽게 풀리기 때문에 여기서는 비선형방정식에 대한 풀이를 다뤄본다. 복잡한 수치해석적인 방법에 대한 소개는 없다. Python으로 어떻게 비선형방정식을 푸는지, 어떤 모듈이 필요한지 계산 예시를 통해 소개한다. 화학공학에서 종종 만나게 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Engineering-Calculation3/" class="btn btn-outline-primary" prompt="Older"><p>[Eng. Calc.] Nonlinear Equations Solving</p></a> <a href="/posts/python-automation-gui/" class="btn btn-outline-primary" prompt="Newer"><p>[Python] Automation - 1. GUI</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ch-hey">HEY</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/engineering-calculation/">Engineering Calculation</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/andrew-ng/">Andrew NG</a> <a class="post-tag" href="/tags/aspen-plus/">Aspen Plus</a> <a class="post-tag" href="/tags/com-object/">COM Object</a> <a class="post-tag" href="/tags/coursera/">Coursera</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
